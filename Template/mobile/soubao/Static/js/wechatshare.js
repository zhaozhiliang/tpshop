(function(e){function t(e){this._fields={Username:4,Password:5,Port:7,Protocol:2,Host:6,Pathname:8,URL:0,Querystring:9,Fragment:10},this._values={},this._regex=null,this._regex=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/;for(var t in this._fields)this["get"+t]=this._makeGetter(t)}function r(){var e=navigator.userAgent;e=e.toLowerCase();if(navigator.userAgent.indexOf("feiniuapp")>-1){var t=navigator.userAgent.split(" ");for(var r=0;r<t.length;r++)if(t[r].indexOf("feiniuapp")>-1){var i=t[r].split("/"),s=i[1].toLowerCase();if(s=="android")return 1;if(s=="iphone")return 2;if(s=="ipad")return 4;if(s=="winphone")return 5}}else{if(n.getParam("osType")&&n.getParam("osType")!="")return e.match(/MicroMessenger/i)=="micromessenger"?9:n.getParam("osType");if(e.match(/MicroMessenger/i)=="micromessenger")return 9}return 3}function i(){function u(t,n){var r="cb"+u.counter++,i="getJSONP."+r;t.indexOf("?")===-1?t+="?callback="+i:t+="&callback="+i;var s=document.createElement("script");e.getJSONP=u,u[r]=function(e){try{n(e)}finally{delete u[r],s.parentNode.removeChild(s)}},s.src=t,document.body.appendChild(s)}var t=this;this.environment="m";var n=["m","preview","beta","test","dev","local"],r=location.hostname.split(".");if(r[0])for(var i in n)n[i]==r[0]&&(this.environment=r[0]);this.h5Domain=function(){return this.environment=="m"?"http://"+this.environment+".feiniu.com/":"http://"+this.environment+".m.feiniu.com/"};var s={appId:this.environment=="m"?"wx1508ecc0aae548ff":this.environment=="preview"?"wxb839845b61eb376b":"wxd734af53543b690f",timestamp:0,nonceStr:"",signature:""},o={title:"飞牛网",desc:"大润发网上商城--精致生活每一天,飞牛伴你而行",link:location.href,imgUrl:location.origin+"/static/img/share/logo_200x200px.png"};u.counter=0,this.setWXShareConfig=function(e){var n=function(e){s.timestamp=e.timestamp,s.nonceStr=e.noncestr,s.signature=e.ticket,t.wxshare()};e===0&&$.ajax({type:"POST",url:t.h5Domain()+"/weixin/index/getSignatureByAjax",data:"url="+encodeURIComponent(location.href),success:function(e){if(!e)return;e=JSON.parse(e),s.timestamp=e.timestamp,s.nonceStr=e.noncestr,s.signature=e.ticket,t.wxshare()}}),e===1&&u(t.h5Domain()+"weixin/index/getSignatureByAjax?url="+encodeURIComponent(location.href),n)},this.getId=function(e){return document.getElementById(e)},this.init=function(e,n){var r=this.getId("wechatShare");if(typeof wx=="undefined")return!1;$.extend(!0,o,e),t.setWXShareConfig(n)},this.wxshare=function(){wx.config({debug:!1,appId:s.appId,timestamp:s.timestamp,nonceStr:s.nonceStr,signature:s.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]}),wx.ready(function(){wx.onMenuShareAppMessage(o),wx.onMenuShareTimeline(o),wx.onMenuShareQQ(o),wx.onMenuShareWeibo(o)}),wx.error(function(e){console.log(e.errMsg)}),wx.error(function(e){console.log(e)})}}t.prototype={parse:function(e){this.url=e;for(var t in this._fields)this._values[t]="";var n=this._regex.exec(e);if(!n)throw"URLParser::_parse -> Invalid URL";for(var t in this._fields)typeof n[this._fields[t]]!="undefined"&&(this._values[t]=n[this._fields[t]]);if(this._values.Querystring.length){var r=this._values.Querystring,i={},s=r.split("&");for(var o=0;o<s.length;o++){var u=s[o],a=u.split("="),f=a[0],l=decodeURI(a[1]);if(f in i){if(!/array/i.test(Object.prototype.toString.call(i[f]))){var c=i[f];i[f]=[],i[f].push(c)}i[f].push(l)}else i[f]=l}this._values.Params=i}return this._values},_makeGetter:function(e){return this.refresh(),function(){return this._values[e]}},getParam:function(e){this.refresh();var t=this.getParamObject(e);return/array/i.test(Object.prototype.toString.call(t))?t[t.length-1]:t},getParamObject:function(e){return this.refresh(),this._values.Params?this._values.Params[e]?/array/i.test(Object.prototype.toString.call(this._values.Params[e]))?this._values.Params[e].map(function(e){return decodeURIComponent(e)}):decodeURIComponent(this._values.Params[e]):this._values.Params[e]:null},getHash:function(){return this.refresh(),location.hash},setHash:function(e){this.refresh(),"pushState"in history&&(e==""||e==null||e.length&&e.trim()=="")?history.pushState("",document.title,location.pathname+location.search):location.hash=e},replaceHash:function(e){this.refresh(),"replaceState"in history?history.replaceState("",document.title,location.pathname+location.search+(e==""?"":"#"+e)):location.hash=e},getDomainUrl:function(){return this.refresh(),this.getProtocol()+"://"+this.getHost()},getTouchBaseUrl:function(){return this.refresh(),this.getDomainUrl()+"/"},refresh:function(){this.url!=location.href&&this.parse(location.href)},redirect:function(e){location.href=e},xss:function(e){return e==undefined||typeof e!="string"?e:(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e)}};var n=new t(location.href),s={init:function(e,t){var n=r();if(n!=9)return;(new i).init(e,t)}};e.wechatShare=s})(window);