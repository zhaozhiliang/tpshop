define("api/address",["config/url"],function(e){return{getAddrList:{apiName:"miscGetaddrlist",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{action:"?",addr_id:"?"},method:"post"},adminAddr:{apiName:"miscAdminaddr",isOnlyData:1,post:{areaCode:"?",token:"?",body:"??"},body:{action:"?",need_know_support_offline_pay:"?",addr:"?"},method:"post"},setDefaultAddr:{url:e.sappsDomain+"citylist/defaultAddress",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{consignee_id:"?",consignee_default:"?"},method:"post"}}}),define("model/address",["lib/common","api/address"],function(e,t){function n(){var t={token:e.cookie.getH5("token"),areaCode:e.cookie.getH5("siteid"),body:{}};return t}function r(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.getAddrList,s),function(e){try{i&&i(e)}catch(t){throw t}})}function i(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.adminAddr,s),function(e){try{i&&i(e)}catch(t){throw t}})}function s(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.adminAddr,s),function(e){try{i&&i(e)}catch(t){throw t}})}function o(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.adminAddr,s),function(e){try{i&&i(e)}catch(t){throw t}})}function u(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.setDefaultAddr,s),function(e){try{i&&i(e)}catch(t){throw t}})}return{getAddrList:r,addAddress:i,delAddress:s,editAddress:o,setDefaultAddress:u}}),define("api/area",["config/url"],function(e){return{getCityList:{url:e.gappDomain+"general/GetCityList",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{versionNo:"?",code:"?",downLevel:"?"},method:"post"},getProvinces:{apiName:"citylistGetprovinces",isOnlyData:1,post:{token:"?",body:"??"},body:{province:"?",cityName:"?"},method:"post"},getNextAddress:{apiName:"citylistGetNextAddress",isOnlyData:1,post:{token:"?",body:"??"},body:{areaCode:"?"},method:"post"},deliveryArea:{url:e.gappDomain+"citylist/deliveryArea",isOnlyData:1,post:{apiVersion:e.apiVersion,token:"?",body:"??"},body:{areaCode:"?",itno:"?"},method:"post"}}}),define("model/area",["lib/common","api/area"],function(e,t){function n(){var t={token:e.cookie.getH5("token"),areaCode:e.cookie.getH5("siteid"),body:{versionNo:"1",code:"0",downLevel:3}};return t}function r(){var t={token:e.cookie.getH5("token"),body:{areaCode:"",province:"",cityName:"",itno:""}};return t}function i(r,i){var s=n(),r=r||{};r.body&&e.merge(s.body,r.body),e.xsr(e.makeUrl(t.getCityList,s),function(e){try{i&&i(e)}catch(t){throw t}})}function s(n,i){var s=r(),n=n||{};n.body&&e.merge(s.body,n.body),e.xsr(e.makeUrl(t.getProvinces,s),function(e){try{i&&i(e)}catch(t){throw t}})}function o(n,i){var s=r(),n=n||{};n.body&&e.merge(s.body,n.body),e.xsr(e.makeUrl(t.getNextAddress,s),function(e){try{i&&i(e)}catch(t){throw t}})}function u(n,i){var s=r(),n=n||{};n.body&&e.merge(s.body,n.body),e.xsr(e.makeUrl(t.deliveryArea,s),function(e){try{i&&i(e)}catch(t){throw t}})}return{getCityList:i,getProvinces:s,getNextAddress:o,deliveryArea:u}}),define("config/regular",[],function(){return{address:/^[\u4e00-\u9fbb\u3002\u3003\u3009-\u3012\uff02-\uff64\u2011-\u2016\u2019\u201d\u201e\u2020\x20-\x2e\x30-\x3b\x3d\x3f-\x7e]{1,45}$/,invoice:/^[\u4e00-\u9fbb\u3002\u3003\u3009-\u3012\uff02-\uff64\u2011-\u2016\u2019\u201d\u201e\u2020\x20-\x2e\x30-\x3b\x3d\x3f-\x7e]{1,100}$/,urlformat:/^((http|https):\/\/)((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,date:/^(\d{4})(-|\/|\.)(\d{1,2})\2(\d{1,2})$/,ascii:/^[\\x00-\\xFF]+$/,zipcode:/^\d{6}$/i,picture:/(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)(\s|\?|$)/i,qq:/^[1-9][0-9]{4,20}$/,bankcardnum:/^[1-9][0-9]{10,30}$/,phone:/^1\d{10}$/,telphone:/^[\d-]{3,20}$/,telephone:/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/,username:/^[_a-zA-Z][_0-9a-zA-Z-]{3,19}$/i,email:/^[a-z0-9]([a-z0-9\\.]*[-_]{0,4}?[a-z0-9\\.]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+([\.][\w_-]+){1,5}$/i,password:/^[a-z0-9_-]{6,18}$/,chinese:/[\u4E00-\u9FA5]/,captcha:/^\w{4,6}$/}}),define("widget/verifySpechars",[],function(){function e(e){var t=e||{},n=!0;return t.str=t.str||"",t.nameStr=t.nameStr||"",t.str.replace(/([^\u4E00-\u9FFF_0-9a-zA-Z-#\.\·])+/,function(e,r){e&&(t.errId&&$("#"+t.errId).text(t.nameStr+"不允许输入特殊字符"+r),n=!1)}),n}function t(e,t){if(!t)return e.match(/([^\u4E00-\u9FFF_a-zA-Z-#\.\·])+/)||"";if(t=="name")return e.match(/([^\u4E00-\u9FFF_a-zA-Z-#\.\·])+/)||"";if(t=="detailAddr")return e.match(/^([\u4e00-\u9fa5]|[a-zA-z]|[0-9]|[.-]|[._])+$/g)}function n(t,n){var r=e(t);n&&n(r)}return{filterSpechars:e,detectSpechars:t,verifySpechars:n}}),define("widget/popAlert",["lib/common"],function(e){function t(t,n,r){if(typeof t=="undefined")return"";var i=n?"popbg tmbg":"popbg",r=r||3e3;window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o=['<div class="'+i+'" id="'+s+'" >','<div class="popbox">','<p class="poptxt">'+t+"</p>","</div></div>"].join("");e("body").append(o);var u=e("#"+s);u.on("click",function(){u.remove()}),setTimeout(function(){u.remove()},r)}function n(t,n,r){if(typeof t=="undefined")return"";window.popAlertIndex=(window.popAlertIndex||0)+1;var i="popalert_"+window.popAlertIndex,s="close_popalert_"+window.popAlertIndex,o="fun_popalert_"+window.popAlertIndex,u=s,a="",f="";typeof n=="function"&&(u=o,a='<p id="'+s+'">取消</p>',f='<p class="poptip">提示</p>');var l=['<div class="popbg" id="'+i+'">','<div class="popbox">',f,'<p class="poptxt">'+t+"</p>",'<div class="popbtnbox">',a,'<p id="'+u+'">确定</p>',"</div></div></div>"].join("");e("body").append(l);var c=e("#"+i);e("#"+s).on("click",function(){c.remove()}),e("#"+o).on("click",function(){n(r),c.remove()})}function r(t,n,r,i){if(typeof t=="undefined")return"";if(typeof n=="undefined")return"";window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o="close_popalert_"+window.popAlertIndex,u="fun_popalert_"+window.popAlertIndex,a=o,f="",l="";typeof i=="function"&&(a=u,f='<p id="'+o+'">取消</p>',l='<p class="poptip">'+t+"</p>");var c=['<div class="popbg" id="'+s+'">','<div class="popbox">',l,'<input type="'+r+'" class="popinput" placeholder="'+n+'" />','<div class="popbtnbox">',f,'<p id="'+a+'">确定</p>',"</div></div></div>"].join("");e("body").append(c);var h=e("#"+s);e("#"+o).on("click",function(){h.remove()}),e("#"+u).on("click",function(){i(),h.remove()})}function i(t){if(typeof t.msg=="undefined")return"";if(typeof t.one=="undefined"||typeof t.one.name=="undefined")return"";var n="",r="";t.icon&&t.icon.isIcon&&(n=t.icon.iconClass?t.icon.iconClass:"situs",r='<i class="'+n+'"></i>');var i=t.tip?t.tip:"提示";window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o="one_popalert_"+window.popAlertIndex,u="two_popalert_"+window.popAlertIndex,a=t.popClass||"",f="";t.one&&(f+='<p id="'+o+'">'+t.one.name+"</p>"),t.two&&t.two.name!=""&&(f+='<p id="'+u+'">'+t.two.name+"</p>");var l=t.id||"",c=['<div class="popbg '+a+'" id="'+s+'">','<div class="popbox '+l+'">',r,'<p class="poptip">'+i+"</p>",'<p class="poptxt">'+t.msg+"</p>",'<div class="popbtnbox">',f,"</div></div></div>"].join("");e("body").append(c),typeof t.initFun=="function"&&t.initFun(s);var h=e("#"+s),p=function(){h.remove()},d=typeof t.one.fun=="function"?function(){var e=t.one.noClose?t.one.noClose:0;e||p(),t.one.fun()}:p;e("#"+o).on("click",d);if(t.two&&t.two.fun!=""){var v=typeof t.two.fun=="function"?function(){var e=t.two.noClose?t.two.noClose:0;e||p(),t.two.fun()}:p;e("#"+u).on("click",v)}}return{popalert:t,popconfirm:n,popinput:r,popdefine:i}}),define("widget/validateFormV2",["lib/common","widget/popAlert"],function(e,t){function n(t,n,r){var i="#"+t.id,s,o,u;s=t.wrapId?t.wrapId:i+"Li",o=t.errId?t.errId:i+"Err",u=t.errClass?t.errClass:"ad_wrong",e(i).on("blur",function(){e(i).val(e.trim(e(i).val())),n()||(e(s).addClass(u),e(o).show())}).on("focus",function(){r&&r(),e(s).removeClass(u),e(o).hide()})}function r(t,n,r){e("#"+t.id).on("validate",function(){n&&n(t)}).on("focus",function(){r&&r(t)})}function i(t){var n,r,i,s={},o=e("#"+t).serializeArray();if(t){for(r=0,i=o.length;r<i;r++)n=o[r],s[n.name]=n.value;return s}}function s(t,n){var r,s,u,a=i(t),n=n||{};if(a){for(r in n){a[r]=e.trim(a[r]),u=n[r];if(typeof u=="object"){s=u.length;if(typeof s=="number"){for(var f=0;f<s;f++)if(!o(a[r],u[f]))return!1}else if(!o(a[r],u))return!1}}return a}}function o(e,n){var r=!1;return n.off?r=!0:typeof n.way=="function"?r=n.way(e,n):(typeof n.return=="boolean"?r=n.return:typeof n.return=="function"?r=n.return(e,n):(n.regular=n.regular||/.+/,e.match(n.regular)&&(r=!0)),r||t.popalert(n.info,1)),r}function u(e,t){var t=t||20;return e.length<=t}return{validate:n,verify:s,verifyLength:u,validateForm:r}}),define("widget/orderHelper",[],function(){function t(){return e.join(",")}var e=["addr","store_search","point","card","payment","invoice","ci","supportStore","defaultStoreInfo","useScore","useVvipCardNum","useVvipCardPhone","useShopPoint","from3010","makeInvoiceParamObj"];return{paramA:e,paramAstr:t,initPara:function(n){var n=n||"a",r={};r[n]=t();for(var i in e){var s=$.url.getParam(e[i])||"";r[e[i]]=s}return r},getParamStr:function(e){var t="";for(var n in e)t+=n+"="+encodeURIComponent(e[n])+"&";return t.substring(0,t.length-1)}}}),function(e){function t(t){function n(){if(this.udid)return this.udid;var e="",t=this.getTime();return e+="H5_"+t+this.randomString(10),this.udid=e,e}t=t||{},this.ua=navigator.userAgent,this.udid="",this.env=null,this.resolution=e.screen.width+"|"+e.screen.height,this.cookieDomain=function(){var e=/m\.feiniu\.com/i.test(location.href);return e?".feiniu.com":location.hostname.split(".").slice(-2).join(".")},this.getTime=function(){return(new Date).getTime()},this.randomString=function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".split("");e||(e=Math.floor(Math.random()*t.length));var n="";for(var r=0;r<e;r++)n+=t[Math.floor(Math.random()*t.length)];return n},this.createUdid=typeof t.createUdid=="function"?t.createUdid:n,this.getcookie=function(e){var t=new RegExp("(^|;|\\s+)"+e+"=([^;]*)(;|$)"),n=document.cookie.match(t);return n?decodeURIComponent(n[2]):""},this.addcookie=function(e,t,n,r,i){var s=e+"="+encodeURIComponent(t)+"; path="+(n||"/")+(i?"; domain="+i:"");if(r>0){var o=new Date;o.setTime(o.getTime()+r*1e3),s+=";expires="+o.toGMTString()}document.cookie=s},this.delcookie=function(e,t,n){arguments.length==2&&(n=t,t="/"),document.cookie=e+"=;path="+t+";"+(n?"domain="+n+";":"")+"expires=Thu, 01-Jan-70 00:00:01 GMT"},this.getUdid=function(){var e="th5_stat_udid",t=this.getcookie(e);if(t)return t;var n=this.createUdid(),r=31536e3,i=/feiniu\.com/i.test(location.href),s=".feiniu.com";return i||(s=location.hostname.split(".").slice(-2).join(".")),this.addcookie(e,n,"/",r,s),n},this.getEnv=function(){if(this.env!=null)return this.env;var e=["m","preview","test","dev","dev1","local"],t="m",n=location.hostname.split(".");if(n[0])for(var r in e)if(e[r]==n[0]){t=n[0];continue}return this.setEnv(t),t},this.setEnv=function(e){this.env=e},this.getSystemType=function(){var e=this.ua;e=e.toLowerCase();var t="";return e.indexOf("android")>-1||e.indexOf("linux")>-1?t="android":e.indexOf("iphone")>-1||e.indexOf("ipad")>-1||e.indexOf("itouch")>-1||e.indexOf("ipod")>-1||e.indexOf("mac")>-1?t="ios":e.indexOf("windows phone")>-1?t="wp":t="windows",t},this.mix=function(){var e={};for(var t=0;t<arguments.length;t++){var n=arguments[t];for(var r in n)r in e?n[r]!=undefined&&(e[r]=n[r]):e[r]=n[r]}return e},this.getUrlParam=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substr(1).match(t);return n!=null?decodeURIComponent(n[2]):null},this.getMessage=function(){var e=this.getUrlParam("fromtype");return e==null&&(e=document.referrer?document.referrer:""),e},this.getRemarksCfg=function(){var e={terminal_os_ver:"",model:"",brand:"",resolution:this.resolution,browser_type:"",mac:""};return JSON.stringify(this.mix(e))},this.isClient=function(){var e="th5_stat_token",t=86400,n=this.getcookie("th5_token")||"",r=this.getcookie("th5_stat_token")||"";if(n&&r==n)return"";if(r=="-1")return n&&this.addcookie(e,n,"/",t,this.cookieDomain()),"";if(r!=n||!r){var n=n||"-1";this.addcookie(e,n,"/",t,this.cookieDomain())}return this.getRemarksCfg()};var r=this.getTime(),i=this.getcookie("th5_username")||"",s=this.getcookie("th5_sitename")||"",o=this.getcookie("th5_mem_guid")||"";!o&&i&&(o=i),this.getLandingUrl=function(){var t="th5_landing_url",n=this.getcookie(t)||"",r=1800;if(n)return this.addcookie(t,n,"/",r,this.cookieDomain()),n;var i=e.location.href;return this.addcookie(t,i,"/",r,this.cookieDomain()),i},this.getLandingSession=function(){var e="th5_landing_session",t=this.getcookie(e)||"",n=1800;if(t)return this.addcookie(e,t,"/",n,this.cookieDomain()),t;var r="";return r+="H5_"+this.getTime()+this.randomString(10),this.addcookie(e,r,"/",n,this.cookieDomain()),r},this.setLandingSession=function(e){var t="th5_landing_session",n=1800;this.addcookie(t,e,"/",n,this.cookieDomain())},this.getAppid=function(){var e=navigator.userAgent;e=e.toLowerCase();if(navigator.userAgent.indexOf("feiniuapp")>-1){var t=navigator.userAgent.split(" ");for(var n=0;n<t.length;n++)if(t[n].indexOf("feiniuapp")>-1){var r=t[n].split("/"),i=r[1].toLowerCase();if(i=="android")return 1;if(i=="iphone")return 2;if(i=="ipad")return 4;if(i=="winphone")return 5}}else{if(this.getUrlParam("osType")&&this.getUrlParam("osType")!="")return e.match(/MicroMessenger/i)=="micromessenger"?9:this.getUrlParam("osType");if(e.match(/MicroMessenger/i)=="micromessenger")return 9}return 3},this.statAppVal=function(){var e={},t=this.getcookie("th5_stat_app");if(t)try{e=JSON.parse(t)}catch(n){}if(typeof e=="undefined"||!e)e={};return e},this.urlConfigParam={udid:this.getUdid(),mem_guid:o,user_name:i,terminal_os:this.getSystemType(),track_code:this.getcookie("th5_channel_edm_code")||"",network:"",gps:"",city:s,track_tag_name:"",result:"",page_content:"",message:"",cur_req_url:location.href,landing_url:"",session_id:"",track_type:1,referer_url:document.referrer||"",startTime:r,endTime:r,abtest:0,remarks:"",ver:"",traffic_channel:"",dev_type:this.getAppid(),ref_page_id:"",client_type:0},this.shangbao=function(t,n,r){var i="",s=this.getEnv();s=="m"?i="http://flume.feiniu.com/AppCollectLogs/AddH5Log?v="+this.getTime():s=="preview"?i="/stat.php?env=preview&v="+this.getTime():i="/stat.php?env=test&v="+this.getTime(),i+=this.randomString(2);var t=t||{};t.message=="-9"&&(t.message=this.getMessage());var o=this.statAppVal();typeof o=="object"&&(t.client_type=o.client_type,t.ver=o.ver,t.traffic_channel=o.traffic_channel,t.gps=o.gps,t.network=o.network,o.session_id&&this.setLandingSession(o.session_id)),t.landing_url=this.getLandingUrl(),t.session_id=this.getLandingSession();var u=this.mix(this.urlConfigParam,t);for(j in u)u[j]=="-9"&&(u[j]="0"),i+="&"+j+"="+encodeURIComponent(u[j]);typeof n!="function"&&(n=function(){});if(navigator.sendBeacon)navigator.sendBeacon(i,""),n();else{var a=new Image,f;try{var l=new $.Deferred,c=function(){a.removeEventListener("load",c,!1),a.removeEventListener("error",c,!1),clearTimeout(f),n(),l.resolve()};a.addEventListener("load",c,!1),a.addEventListener("error",c,!1),f=setTimeout(c,r||1e3),a.src=i,e._deferRedirect=l}catch(h){a.src=i,n()}}}}var n={isObj:0,shangbao:function(e,n,r){var i="";if(this.isObj)i=this.isObj;else{i=new t(this.opt),this.isObj=i;if(e.h5_type=="edm"){if(i.getUrlParam("tracking_type")!="h5_edm")return"";var s=i.getUrlParam("type");(s=="h5_dev"||s=="h5_test"||s=="h5_beta")&&i.setEnv("test")}var o=i.isClient();if(o){var u={track_tag_name:"1000",result:"",page_content:"",message:"-9",track_type:"6",remarks:o};i.shangbao(u,n,r)}}i.shangbao(e,n,r)},getRemarksCfg:function(){var e="";return this.isObj?e=this.isObj:(e=new t,this.isObj=e),e.getRemarksCfg()}};e.h5stat=n;if(typeof define=="function"&&define.amd)define("widget/stat",["lib/common"],function(t){return e.h5stat});else if(typeof e.Zepto=="undefined"){var r=document.createElement("script");r.src=e.feiniu.url.jsBase+"/lib/zepto.min.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)}}(window),define("widget/loadingV2",["lib/common"],function(e){function u(t,n,s,u){f();var l=e.extend(!0,{},o);typeof t=="object"?e.extend(!0,l,t):(l.off=t,l.topOn=typeof s=="boolean"?s:l.topOn,l.D_dom=u||l.D_dom,typeof n=="boolean"?(l.name=r,l.topOn=n):typeof n=="object"?(l.D_dom=n,l.name=i,l.topOn=!1):l.name=n||r),a(l)}function a(e){var n,r=0;n=t[e.name]||!1;if(n)return typeof e.off=="undefined"||typeof e.off=="string"?t[e.off||e.name].data("count")>>0:(r=n.data("count")>>0,e.off?(n.data("count",++r),r==1&&(e.D_dom.append(n),h(n,e),e.topOn&&e.name!="none"&&c(n,e.topOn))):(n.data("count",--r),r<=0&&(l(n,e),e.name!="none"&&c(n,!1))),name)}function f(){e("[data-load-name]").each(function(){var n=e(this);t[n.data("load-name")]=n})}function l(e,r){typeof e=="string"?e=t[e]:typeof e=="undefined"&&(e=t[r.name]),e.data("count",0),e.remove(),n.off("scroll.loading")}function c(t,r){var i=[],o=e(".top_nav");e.each(s,function(t,n){i=e(n);if(i.length)return!1}),r&&i.length?(n.off("scroll.loading").on("scroll.loading",function(){var e=i.height()+i.offset().top,r=e-n.scrollTop(),s=n.height()-r;t.css({"padding-top":r>0?r:0})}),h(i),i.addClass("z100")):(n.off("scroll.loading"),t.css({"padding-top":""}),i.removeClass("z100")),o.length&&(r?o.addClass("z100"):o.removeClass("z100"))}function h(e){e&&e.off("touchmove.preventDefault").on("touchmove.preventDefault",function(){event.preventDefault()})}var t={none:e("<div></div>"),p1:e('<p class="loading_pop all"><b></b></p>'),p2:e('<p class="loading_btm"><b></b><i>正在努力加载...</i></p>'),v2:e('<p class="loading_pop all"><b></b></p>')},n=e(window),r="p1",i="p2",s=["[data-loading-top]","header",".top_box"];(function(){var n=navigator.userAgent.toLowerCase();if(n.indexOf("qqbrowser")>-1||n.indexOf("ucbrowser")>-1){t.p2=e('<p class="loading_btm"><em></em><i>正在努力加载...</i></p>'),t.p1=e('<p class="loading_pop all"><em></em></p>'),t.v2=e('<p class="loading_pop all"><em></em></p>');var r=1;setInterval(function(){var n=r%18;e.each(t,function(){e(".loading_pop").find("em").css("background-position",-0.9*n+"rem 0")}),r++},40)}})();var o={off:r,name:r,topOn:!0,D_dom:e("body")};return{on:u,off:l}}),define("widget/regionList",["lib/common","widget/loadingV2","widget/popAlert","config/url"],function(e,t,n,r){function h(t,n){if(typeof t.api=="undefined"||typeof t.api.nextaddr!="function")return;if(typeof t.depth=="undefined")return;t.start=t.start?t.start:1;var r=parseInt(t.start)>1&&(typeof t.defaddr=="undefined"||typeof t.addrname=="undefined");if(isNaN(t.start)||r)return;u=e.extend(!0,{},o),u.bg=t.isbg||"",u.needFlag=t.needFlag,u.isfw=t.isfullwidth?"wh":"",u.isarea=t.isarea?1:0,u.title=t.title?t.title:"配送至",u.depth=t.depth,u.defaddr=t.defaddr,u.bkfun=n,u.api.next=t.api.nextaddr,u.api.pro=typeof t.api.provinces=="function"?t.api.provinces:t.api.nextaddr,u.body=t.body?t.body:"",u.gclass=t.gclass?t.gclass:"",u.start=t.start-1,u.addrname=t.addrname,u.id=t.id?t.id:"J_lsps",u.nocarecookie=t.nocarecookie?1:0,u.clickBack=t.clickBack,u.close=function(){c.go()},e("#tpl_PsList").length||e("body").after(f),u.isarea&&!e("#tpl_PsPro").length&&e("body").after(l);if(!e("#div_"+u.id).length){var i='<div id="div_'+u.id+'" class="region_widget hide_it '+u.bg+" "+u.gclass+'" ><div class="reoutbox '+u.isfw+'"></div></div>';e("body").append(i),u.$container=e("#div_"+u.id+" > .reoutbox"),e("#div_"+u.id).on(s," .region_ul dd",m),c.init(u),e("body").on(s,"#"+u.id+(u.needFlag||""),function(t){var n=e(this).attr("id");n=u.needFlag?u.id:n,u=a[n],p(e(this))})}a[u.id]=u}var i=!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),s="click",o={token:e.cookie.getH5("token"),tabs_id:["psProvinces","psCitys","psCountys","psTowns"],tabs_tab:["data-retab=psCitys","data-retab=psCountys","data-retab=psTowns",""],temp_regionname:"",api:{next:null,pro:null},temp_data:{}},u,a=[],f=['<script id="tpl_PsList" type="text/html">','       <div id="div_{{tabs_id}}" class="{{(body[0].type == 1)? "" : "hide_it"}}" data-retab-bk="{{tabs_id}}">','		    <div class="region_title">','				<i class="iconfont" data-rebk="{{tabs_id}}">&#xe60b;</i>',"				<h3>{{title}}</h3>","			</div>","			{{if body[0].type >1}}",'               <div class="selPs">{{seltab}}</div>',"			{{/if}}",'           <div id="{{tabs_id}}" class="region_ul">',"			<dl>","		   {{each body as val i}}",'		        <dd data-icon2="&#xe602;" class="{{(curCode == body[i].code)?"active":""}}" data-depth="{{body[0].type}}" data-rename="{{body[i].name}}" data-recode="{{body[i].code}}"  data-reparcode="{{body[i].parentCode}}" class="{{(i == 0)? "active" : ""}}" {{tabs_tab}}><p>{{val.name}}</p></dd>',"         {{/each}}","          </dl>","       </div>","</script>"].join(""),l=['<script id="tpl_PsPro" type="text/html">','       <div id="div_{{tabs_id}}" data-retab-bk="{{tabs_id}}">','		    <div class="region_title">','				<i class="iconfont" data-rebk="{{tabs_id}}">&#xe60b;</i>',"				<h3>{{title}}</h3>","			</div>",'           <div id="{{tabs_id}}" class="region_ul">',"		   {{each body as val i}}","			<dl>","				<dt>{{val.area}}</dt>","		   {{each val.province as v j}}",'		        <dd data-icon2="&#xe602;" class="{{(curCode == v.code)?"active":""}}" data-depth="{{v.type}}" data-rename="{{v.name}}" data-recode="{{v.code}}"  data-reparcode="{{v.parentCode}}" class="{{(i == 0)? "active" : ""}}" {{tabs_tab}}><p>{{v.name}}</p></dd>',"         {{/each}}","          </dl>","        {{/each}}","        </div>","       </div>","</script>"].join(""),c={re_param:{list:[]},changeTab:function(t){var n=t,r=n.data("retab"),i=e('[data-retab-bk="'+r+'"]'),s=this.re_param;_dp=s.list.length;var o=i.data("dp")>>0;o||(_dp++,s.list.push(i),i.css({"z-index":_dp}).removeClass("hide_it").data("dp",_dp))},go:function(t){var n=this,r=n.re_param,i=r.list.length;t=t-1||0;for(var s=i-1;s>=t;s--)r.list[s].remove();r.list.splice(t,i-t),r.list.length||(e(".region_widget").addClass("hide_it"),u.bg!="tmbg"&&e("body").css({overflow:"",position:"",width:"",height:""}))},init:function(t){var n=this,r=n.re_param;e("body").on(s,"[data-rebk]",function(i){if(e.isFunction(t.clickBack))t.clickBack.call(this,t.$container,t);else{var s=r.list.length;s>0&&n.go(s)}}),e("body").on(s,".region_widget,.reoutbox",function(e){e.target==this&&n.go()})}},p=function(t){u.bg!="tmbg"&&e("body").css({overflow:"hidden",position:"fixed",width:"100%",height:"100%"});var n=u.start==0?"":u.defaddr;if(u.temp_data[n]){var r=[];u.defaddr?r=u.defaddr.split("-"):r=(e.cookie.getH5("siteid")||"CS000017-340300-340399-0").split("-"),u.temp_data[n].curCode=r[u.start],u.start==0?v(t,u.temp_data[n]):(E(t),b(u.start,t,u.temp_data[u.defaddr]))}else u.start==0?d(t):(E(t),m(t))},d=function(n){var r={body:{areaCode:""}};e.merge(r.body,u.body),t.on(!0),u.api.pro(r,function(r){t.on(!1);if(r.errorCode!=0){widgetPopAlert.popalert(r.errorDesc||"网络错误"),c.go();return}var i=[];u.defaddr?i=u.defaddr.split("-"):i=(e.cookie.getH5("siteid")||"CS000017-340300-340399-0").split("-");var s={body:r.body.address,tabs_id:u.tabs_id[0],tabs_tab:u.tabs_tab[0],seltab:u.temp_regionname,curCode:i[0],title:u.title};u.temp_data[""]=s,v(n,u.temp_data[""])})},v=function(t,n){var r="";u.isarea?r=e.tpl("tpl_PsPro",n):r=e.tpl("tpl_PsList",n),e("#div_"+u.id+" .reoutbox").append(r),t.attr("data-retab","psProvinces"),c.changeTab(t),e("#div_"+u.id).removeClass("hide_it")},m=function(t){typeof t.data=="undefined"&&(t=e(this));var n=parseInt(t.data("depth"))||u.start-1,r=u.temp_regionname.split("|"),i=t.parent().parent().attr("id");i!==""&&e("#"+i).hasClass("region_ul")&&(e("#"+i+" dd").removeClass("active"),t.addClass("active"));if(n==3&&u.depth==3){u.temp_regionname+="|"+t.data("rename"),w(t);return}var s=r.length;r.splice(n-1,s-n+1),u.temp_regionname=r.join("|");var o=u.temp_regionname==""?"":"|";u.temp_regionname+=o+t.data("rename");if(n==4){w(t);return}g(n,t)},g=function(r,i){if(u.temp_data[i.data("reparcode")]){y(r,i);return}var s={body:{areaCode:i.data("reparcode")}};e.merge(s.body,u.body),t.on(!0),u.api.next(s,function(s){t.on(!1);if(s.errorCode!=0){n.popalert(s.errorDesc||"网络错误"),c.go();return}var o=[];u.defaddr?o=u.defaddr.split("-"):o=(e.cookie.getH5("siteid")||"CS000017-340300-340399-0").split("-");var a={body:s.body.address,tabs_id:u.tabs_id[r],tabs_tab:u.tabs_tab[r],seltab:u.temp_regionname.toString().replace(/[|]/g,""),curCode:o[r],title:u.title};u.temp_data[i.data("reparcode")]=a,b(r,i,a)})},y=function(t,n){var r=[];u.defaddr?r=u.defaddr.split("-"):r=(e.cookie.getH5("siteid")||"CS000017-340300-340399-0").split("-"),u.temp_data[n.data("reparcode")].curCode=r[t],b(t,n,u.temp_data[n.data("reparcode")])},b=function(t,n,r){if(t==3&&r.body.length==0){w(n);return}var i=e.tpl("tpl_PsList",r);e("#div_"+u.tabs_id[t]).length||(e("#div_"+u.tabs_id[t-1]).length?e("#div_"+u.tabs_id[t-1]).after(i):e("#div_"+u.id+" .reoutbox").append(i)),c.changeTab(n),e("#div_"+u.id).removeClass("hide_it")},w=function(t){if(!u.nocarecookie&&e.cookie.getH5("siteid").split("-").slice(0,u.depth).join("-")==t.data("reparcode").split("-").slice(0,u.depth).join("-")){c.go();return}var n=31536e3,r=u.temp_regionname.split("|"),i=r.join("-").replace(/(^\s*)|(\s*$)/g,"");if(typeof u.bkfun=="function"){var s={};s.code=t.data("reparcode"),s.name=u.temp_regionname.split("|").join("-"),u.bkfun(s)}c.go()},E=function(e){u.temp_regionname=u.addrname;var t=u.addrname.split("|")[u.start-1],n=u.defaddr.split("-")[u.start-1],r=u.tabs_id[u.start];if(typeof t=="undefined"||typeof n=="undefined"||typeof r=="undefined")return;e.data("depth",u.start),e.data("rename",t),e.data("recode",n),e.data("retab",r),e.data("reparcode",u.defaddr)};return{init:h}}),require(["lib/common","config/url","model/address","model/area","config/regular","widget/verifySpechars","widget/validateFormV2","widget/orderHelper","widget/popAlert","widget/stat","widget/regionList"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";function N(e,t){for(var n=0,r=e.length;n<r;n++)y==e[n].code&&(d[t]=e[n].child)}function C(t,n){e("."+t).show(),e("."+n).hide()}function k(t){var n=e("#"+t.id),r=e.trim(n.val()),u=n.siblings("span").text();v=!0,u=u.substring(0,u.length-1);if(!r&&!t.optional){a.popalert("请输入"+(u||"收货地址")),v=!1;return}switch(t.id){case"J_username":o.verifyLength(r,20)||(a.popalert("收货人信息不能多于20个字符"),v=!1);var f=s.detectSpechars(r,"name");f&&(a.popalert(u+"只能填写中文和英文"),v=!1);break;case"J_cellphone":r.match(i.phone)||(a.popalert("手机号码格式不正确"),v=!1);break;case"J_tel":r&&!r.match(i.telephone)&&(a.popalert("固定电话号码格式不正确"),v=!1);break;case"J_detailArea":o.verifyLength(r,45)||(a.popalert("详细收货地址信息不能多于45个字符"),v=!1);var f=s.detectSpechars(r,"detailAddr");f||(a.popalert(u+"不允许输入特殊字符"),v=!1)}}function L(){v=!0}function A(){T.forEach(function(e){o.validateForm(e,k,L)})}function O(){for(var t=0,r=T.length;t<r;t++){e("#"+T[t].id).trigger("validate");if(!v)return""}e(".J_loading_all").show();var i={body:{action:1,from:m,is_seperate:p.is_seperate,is_overseas:p.is_overseas,addr:{name:e("#J_username").val(),province:E[0],city:E[1],area:E[2],town:E[3]||"",zip:S,addr:e("#J_detailArea").val(),tel:e("#J_tel").val(),cellPhone:e("#J_cellphone").val(),areaCode:x}}};n.addAddress(i,function(t){e(".J_loading_all").hide();if(t.errorCode==0){i.body.addr.addrId=t.body.addrId,i.body.addr.cityCode=t.body.cityCode,i.body.addr.province=t.body.province;var n=JSON.stringify(i.body.addr),r=u.getParamStr(h);e.url.redirect(e.url.getTouchBaseUrl()+"order/index.html?"+r+"&addr="+encodeURIComponent(n))}else e.alert(t.errorDesc||"网络错误")})}function M(){var t={isbg:"tmbg",isfullwidth:1,isarea:1,title:"新增收货人地址",api:{provinces:r.getProvinces,nextaddr:r.getNextAddress},depth:3,nocarecookie:1,defaddr:"0-0-0-0",clickBack:function(e,t){t.close()}};l.init(t,function(t){x=t.code;var n=t.name.split("-");E=n,e(".J_selectAddress").val(n.slice(0,3).join("")),e(".J_selectAddressNext").val(n.slice(3).join(""));var i=x.split("-");i[3]=0;var s={isbg:"tmbg",isfullwidth:1,isarea:1,title:"新增收货人地址",api:{provinces:r.getProvinces,nextaddr:r.getNextAddress},depth:4,id:"J_addr4",start:4,defaddr:i.join("-"),addrname:n.join("|"),nocarecookie:1,clickBack:function(e,t){t.close()}};l.init(s,function(t){x=t.code;var n=t.name.split("-");E=n,e(".J_selectAddressNext").val(n[3])})})}function _(){A(),e(".J_back").on("click",function(){switch(g){case 3:C("J_disContainer","J_areaContainer");break;case 2:C("J_provContainer","J_disContainer");break;case 1:C("J_form","J_provContainer");break;case 0:history.go(-1)}g-=1,b.pop()}),e("#J_lsps").on("click",function(){e(this).blur()}),e("#J_addr4").on("click",function(){e(this).blur()}),e(".J_save").on("click",function(){O()})}e.url.options.ssKey=1;if(e.cookie.getH5("islogin")!=1){var c=location.href;e.url.redirect(e.url.getTouchBaseUrl()+"login/index.html?gotourl="+encodeURIComponent(c));return}var h=u.initPara(),p=e.isNull(h.ci)?{action:7,is_seperate:0,is_overseas:0}:JSON.parse(h.ci),d={cityList:[],districtList:[],areaList:[],name:""},v=!0,m=2,g=0,y="",b=[],w=!0,E="",S="",x="",T=[{id:"J_username",optional:!1},{id:"J_cellphone",optional:!1},{id:"J_tel",optional:!0},{id:"J_detailArea",optional:!1},{id:"J_lsps",optional:!1},{id:"J_addr4",optional:!0}];e.getToken(function(){_(),M()});var D={track_tag_name:"5020",result:"",page_content:"",track_type:"1",message:""};f.shangbao(D)}),define("controller/order/address/addV2",function(){});