define("api/invoice",["config/url"],function(e){return{makeInvoice:{url:e.sappsDomain+"order/MakeInvoice",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{orderId:"?",name:"?",zip:"?",province:"?",city:"?",area:"?",addr:"?",invoiceType:"1",invoiceTitle:"?"},method:"post"},getInvoiceList:{url:e.sappsDomain+"order/GetInvoiceList",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{orderId:"?"},method:"post"},GetDZInvoiceList:{apiName:"orderGetdzinvoicelist",isOnlyData:1,post:{areaCode:"?",token:"?",body:"??"},body:{orderId:"?"},method:"post"},getRecordInvoice:{url:e.sappsDomain+"invoice/getRecordInvoice",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{invoice_shop:"?"},method:"post"},makeInvoiceAdd:{apiName:"orderMakeinvoice",isOnlyData:1,post:{apiVersion:e.apiVersion,areaCode:"?",token:"?",body:"??"},body:{orderId:"?",name:"?",zip:"?",province:"?",city:"?",area:"?",addr:"?",invoiceType:"1",invoiceTitle:"?",invkind:"?"},method:"post"}}}),define("model/order/invoice",["lib/common","api/invoice"],function(e,t){function n(){var t={token:e.cookie.getH5("token"),areaCode:e.cookie.getH5("siteid"),body:{invoiceType:1}};return t}function r(r,i,s,o){var u=n(),i=i||{};i.body&&e.merge(u.body,i.body),e.xsr(e.makeUrl(t[r],u),function(t){try{o||t.errorCode==1e3&&e.alert(t.errorDesc,2e3),s&&s(t)}catch(n){throw n}})}function i(n,r){var n=n||{},i={token:e.cookie.getH5("token"),areaCode:e.cookie.getH5("siteid"),body:{}};n.body&&e.merge(i.body,n.body),e.xsr(e.makeUrl(t.getRecordInvoice,i),function(e){try{r&&r(e)}catch(t){throw t}})}function s(){var t={token:e.cookie.getH5("token"),areaCode:e.cookie.getH5("siteid"),body:{pointType:"1",vcs_status:"0",onePageSize:10,pageIndex:1}};return t}function o(n,r){var i=s(),n=n||{};n.body&&e.merge(i.body,n.body),e.xsr(e.makeUrl(t.GetDZInvoiceList,i),function(e){try{r&&r(e)}catch(t){throw t}})}function u(n,r){var i=s(),n=n||{};n.body&&e.merge(i.body,n.body),e.xsr(e.makeUrl(t.makeInvoiceAdd,i),function(e){try{r&&r(e)}catch(t){throw t}})}return{ge:r,getDZInvoiceList:o,getRecordInvoice:i,makeInvoiceAdd:u}}),define("widget/util",[],function(){return{getTime:function(){return(new Date).getTime()},oneOrZero:function(){return Math.round(Math.random())},padZero:function(e,t){var n=e.toString();do{var r=n.indexOf(".")>-1?n.indexOf("."):n.length;r<t&&(n="0"+n)}while(r<t);return n},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"").replace(/(^　*)|(　*$)/g,"")},getId:function(e){return document.getElementById(e)},dateFormat:function(e,t){var e=new Date(e),n={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),q:Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},t=t.replace(/([yMdhmsqS])+/g,function(t,r){var i=n[r];return i!==undefined?(t.length>1&&(i="0"+i,i=i.substr(i.length-2)),i):r==="y"?(e.getFullYear()+"").substr(4-t.length):t});return t},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(e).replace(/[&<>"'\/]/g,function(e){return t[e]})},countdown:function(e,t,n,r){var i=setInterval(function(){if(0>=e){clearInterval(i);try{r&&r()}catch(s){throw s}return}var o=--e;e<10&&(o="0"+e),n.innerHTML=o+t},1e3)},xss:function(e){return e==undefined||typeof e!="string"?e:(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),e)}}}),define("widget/imgHelper",["lib/common"],function(e){function n(e){if(typeof t[e]!="undefined")return t[e];var n=new Image;n.src=e,t[e]=n.src}var t={};return{set_getImg:n}}),define("widget/templateHelper",["lib/common","widget/util","widget/imgHelper"],function(e,t,n){return{helper:function(){e.tpl.helper("dateFormat",function(e,n){var r=t.dateFormat(e,n);return r}),e.tpl.helper("dateTimeFormat",function(e,n){var r=/^(\d{4})(-|\/|\.)(\d{1,2})\2(\d{1,2})(\s+(\d{1,2}):(\d{1,2}):(\d{1,2}))*$/,i=e.match(r);if(i){var s=i[1],o=parseInt(i[3],10)-1,u=i[4],a=i[6]||"",f=i[7]||"",l=i[8]||"",c=new Date(s,o,u,a,f,l),h=c.getTime();return t.dateFormat(h,n)}return""}),e.tpl.helper("timeStampFormat",function(e,n){return t.dateFormat(e||0,n||"")}),e.tpl.helper("dateYMDFormat",function(e,t){var n=e||"",r=t||"";return n.split(" ")[0].replace(/[\.\-\\]/g,"/")}),e.tpl.helper("pointKind",function(e){var t=e||"",n="";switch(t){case"point":n="抵用券";break;case"voucher":n="优惠券";break;case"bonus":n="购物金"}return n}),e.tpl.helper("priceFormat",function(e,t){var t=t||0,e=e||0;return t==0?e=parseFloat(e):t==-1?e=parseInt(e):e=parseFloat(e).toFixed(t),e}),e.tpl.helper("idcardFormat",function(t){if(e.isNull(t))return;var n=4,r=4,i=t.length-n-r,s="";for(var o=0;o<i;o++)s+="*";return t.substr(0,n)+s+t.substr(t.length-r)}),e.tpl.helper("phoneOrEmailFormat",function(t,n){if(e.isNull(t))return;if(n==1){var r=3,i=4,s=t.length-r-i,o="";for(var u=0;u<s;u++)o+="*";return t.substr(0,r)+o+t.substr(t.length-i)}var a=t.substring(0,t.indexOf("@")),f=t.substring(t.indexOf("@"),t.length),r=1,i=1,s=a.length-r-i,o="";for(var u=0;u<s;u++)o+="*";return t.substr(0,r)+o+a.substr(a.length-i)+f}),e.tpl.helper("priceFormat2",function(e){return typeof e=="string"&&(e=parseFloat(e)),isNaN(e)?"0.00":e.toFixed(2)}),e.tpl.helper("getImg",function(e){return n.set_getImg(e)}),e.tpl.helper("intDecimalPrice",function(e,t){var e=e||"0.00",t=t||1,n="";typeof e!="string"&&(e=e.toString());switch(t){case 1:return((e.replace(",","")|0)+"").replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,");case 2:return n=e.split(".")[1],n=n===undefined?"00":n.length==1?n+"0":n,n}}),e.tpl.helper("deCodeHtml",function(e){return e.replace(/&gt;/gi,">").replace(/&lt;/gi,"<")}),e.tpl.helper("removeTag",function(e){return e.replace(/\<[^\<|^\>]*\>/gi,"")}),e.tpl.helper("forNumOpt",function(e){var t="";e=parseInt(e,10);for(var n=1;n<=e;n++)t+='<option value="'+n+'">'+n+"</option>";return t}),e.tpl.helper("getHtmlContent",function(e){return e.match(/>([\s\S]*?)<\//)[1]})}}}),define("widget/popAlert",["lib/common"],function(e){function t(t,n,r){if(typeof t=="undefined")return"";var i=n?"popbg tmbg":"popbg",r=r||3e3;window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o=['<div class="'+i+'" id="'+s+'" >','<div class="popbox">','<p class="poptxt">'+t+"</p>","</div></div>"].join("");e("body").append(o);var u=e("#"+s);u.on("click",function(){u.remove()}),setTimeout(function(){u.remove()},r)}function n(t,n,r){if(typeof t=="undefined")return"";window.popAlertIndex=(window.popAlertIndex||0)+1;var i="popalert_"+window.popAlertIndex,s="close_popalert_"+window.popAlertIndex,o="fun_popalert_"+window.popAlertIndex,u=s,a="",f="";typeof n=="function"&&(u=o,a='<p id="'+s+'">取消</p>',f='<p class="poptip">提示</p>');var l=['<div class="popbg" id="'+i+'">','<div class="popbox">',f,'<p class="poptxt">'+t+"</p>",'<div class="popbtnbox">',a,'<p id="'+u+'">确定</p>',"</div></div></div>"].join("");e("body").append(l);var c=e("#"+i);e("#"+s).on("click",function(){c.remove()}),e("#"+o).on("click",function(){n(r),c.remove()})}function r(t,n,r,i){if(typeof t=="undefined")return"";if(typeof n=="undefined")return"";window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o="close_popalert_"+window.popAlertIndex,u="fun_popalert_"+window.popAlertIndex,a=o,f="",l="";typeof i=="function"&&(a=u,f='<p id="'+o+'">取消</p>',l='<p class="poptip">'+t+"</p>");var c=['<div class="popbg" id="'+s+'">','<div class="popbox">',l,'<input type="'+r+'" class="popinput" placeholder="'+n+'" />','<div class="popbtnbox">',f,'<p id="'+a+'">确定</p>',"</div></div></div>"].join("");e("body").append(c);var h=e("#"+s);e("#"+o).on("click",function(){h.remove()}),e("#"+u).on("click",function(){i(),h.remove()})}function i(t){if(typeof t.msg=="undefined")return"";if(typeof t.one=="undefined"||typeof t.one.name=="undefined")return"";var n="",r="";t.icon&&t.icon.isIcon&&(n=t.icon.iconClass?t.icon.iconClass:"situs",r='<i class="'+n+'"></i>');var i=t.tip?t.tip:"提示";window.popAlertIndex=(window.popAlertIndex||0)+1;var s="popalert_"+window.popAlertIndex,o="one_popalert_"+window.popAlertIndex,u="two_popalert_"+window.popAlertIndex,a=t.popClass||"",f="";t.one&&(f+='<p id="'+o+'">'+t.one.name+"</p>"),t.two&&t.two.name!=""&&(f+='<p id="'+u+'">'+t.two.name+"</p>");var l=t.id||"",c=['<div class="popbg '+a+'" id="'+s+'">','<div class="popbox '+l+'">',r,'<p class="poptip">'+i+"</p>",'<p class="poptxt">'+t.msg+"</p>",'<div class="popbtnbox">',f,"</div></div></div>"].join("");e("body").append(c),typeof t.initFun=="function"&&t.initFun(s);var h=e("#"+s),p=function(){h.remove()},d=typeof t.one.fun=="function"?function(){var e=t.one.noClose?t.one.noClose:0;e||p(),t.one.fun()}:p;e("#"+o).on("click",d);if(t.two&&t.two.fun!=""){var v=typeof t.two.fun=="function"?function(){var e=t.two.noClose?t.two.noClose:0;e||p(),t.two.fun()}:p;e("#"+u).on("click",v)}}return{popalert:t,popconfirm:n,popinput:r,popdefine:i}}),define("widget/orderHelper",[],function(){function t(){return e.join(",")}var e=["addr","store_search","point","card","payment","invoice","ci","supportStore","defaultStoreInfo","useScore","useVvipCardNum","useVvipCardPhone","useShopPoint","from3010","makeInvoiceParamObj"];return{paramA:e,paramAstr:t,initPara:function(n){var n=n||"a",r={};r[n]=t();for(var i in e){var s=$.url.getParam(e[i])||"";r[e[i]]=s}return r},getParamStr:function(e){var t="";for(var n in e)t+=n+"="+encodeURIComponent(e[n])+"&";return t.substring(0,t.length-1)}}}),define("config/regular",[],function(){return{address:/^[\u4e00-\u9fbb\u3002\u3003\u3009-\u3012\uff02-\uff64\u2011-\u2016\u2019\u201d\u201e\u2020\x20-\x2e\x30-\x3b\x3d\x3f-\x7e]{1,45}$/,invoice:/^[\u4e00-\u9fbb\u3002\u3003\u3009-\u3012\uff02-\uff64\u2011-\u2016\u2019\u201d\u201e\u2020\x20-\x2e\x30-\x3b\x3d\x3f-\x7e]{1,100}$/,urlformat:/^((http|https):\/\/)((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?(\w*)/,date:/^(\d{4})(-|\/|\.)(\d{1,2})\2(\d{1,2})$/,ascii:/^[\\x00-\\xFF]+$/,zipcode:/^\d{6}$/i,picture:/(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)(\s|\?|$)/i,qq:/^[1-9][0-9]{4,20}$/,bankcardnum:/^[1-9][0-9]{10,30}$/,phone:/^1\d{10}$/,telphone:/^[\d-]{3,20}$/,telephone:/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/,username:/^[_a-zA-Z][_0-9a-zA-Z-]{3,19}$/i,email:/^[a-z0-9]([a-z0-9\\.]*[-_]{0,4}?[a-z0-9\\.]+)*@([a-z0-9]*[-_]?[a-z0-9]+)+([\.][\w_-]+){1,5}$/i,password:/^[a-z0-9_-]{6,18}$/,chinese:/[\u4E00-\u9FA5]/,captcha:/^\w{4,6}$/}}),require(["lib/common","model/order/invoice","widget/templateHelper","widget/popAlert","widget/orderHelper","config/regular"],function(e,t,n,r,i,s){e.url.options.ssKey=1;var o=i.initPara(),u=e.parseJSON(o.invoice);typeof u=="string"&&(u=JSON.parse(u));var a=function(){var n=function(n){t.getRecordInvoice({body:{invoice_shop:u.invoice_shop}},function(t){t.errorCode==0?(e.each(t.body.invoice,function(t,n){n.isChecked=parseInt(u.invoice_kind)===parseInt(n.invoice_kind)?1:0,parseInt(u.invoice_shop)===1&&parseInt(n.invoice_kind)===5?n.disabled=1:n.disabled=0,parseInt(u.invoice_kind)===parseInt(n.invoice_kind)&&u.invoice_title!="个人"?n.invoice_title=u.invoice_title:n.invoice_title="";if(parseInt(u.invoice_kind)===parseInt(n.invoice_kind)&&parseInt(n.invoice_kind)!=0&&n.invoice_info){var r=n.invoice_info.title_arr;e.each(r,function(e,t){t.isChecked=parseInt(u.invoice_type)===parseInt(t.choice)?1:0})}}),e.log("data:",t.body),e(".tip").html(e.tpl("tpl_remind",t.body)),e(".J_tab").html(e.tpl("tpl_invotitle",t.body)),e(".J_invoice_box").html(e.tpl("tpl_invoInfo",t.body)),n&&n()):r.popalert(t.errorDesc)})};return{init:n}}();e.getToken(function(){n.helper(),a.init(function(){e(".J_invoice_kind").on("click",function(){var t=e(this).find("input[type=radio][name=reg]"),n=t.prop("checked");if(t.prop("checked"))return;if(t.prop("disabled"))return;return t.prop("checked",!n),e(".reg_box").addClass("hide"),t.data("type")==5?e(".electr_box").removeClass("hide").find("input[type=radio]:first-child").prop("checked",!0):t.data("type")==4?e(".paper_box").removeClass("hide").find("input[type=radio]:first-child").prop("checked",!0):t.data("type")==0?e(".vat_box").removeClass("hide"):t.data("type")==13&&e(".noInvoice_box").removeClass("hide"),!1}),e("input[type=radio][name=reg]").change(function(){e(".reg_box").addClass("hide"),e(this).data("type")==5?e(".electr_box").removeClass("hide").find("input[type=radio]:first-child").prop("checked",!0):e(this).data("type")==4?e(".paper_box").removeClass("hide").find("input[type=radio]:first-child").prop("checked",!0):e(this).data("type")==0?e(".vat_box").removeClass("hide"):e(this).data("type")==13&&e(".noInvoice_box").removeClass("hide")}),e("input[type=radio][name=reg3]").change(function(){e("input[type=text]",e(this).parents(".reg_box")).val("")}),e(".btn_box > .btn_red, .J_submit").on("click",function(){var t=e(this).data("kind"),n=e("input[type=radio]:checked",e(this).parents(".reg_box")).val(),a=e("input[type=text]",e(this).parents(".reg_box")).val(),f=e("#invoice"+t).html();if(e(this).data("position")=="header"){var l=e(".J_tab input:checked").data("type");l==4?(t=4,n=e("input[type=radio]:checked",e(".paper_box")).val(),a=e("input[type=text]",e(".paper_box")).val(),f=e("#invoice"+t).html()):l==0?(t=0,n=e("input[type=radio]:checked",e(".vat_box")).val(),a=e("input[type=text]",e(".vat_box")).val(),f=e("#invoice"+t).html()):l==5?(t=5,n=e("input[type=radio]:checked",e(".electr_box")).val(),a=e("input[type=text]",e(".electr_box")).val(),f=e("#invoice"+t).html()):l==13&&(t=13,n=e("input[type=radio]:checked",e(".noInvoice_box")).val(),a=e("input[type=text]",e(".noInvoice_box")).val(),f=e("#invoice"+t).html())}if(t==4&&parseInt(n)===3&&e.isNull(a)){r.popalert("请输入发票抬头！");return}(t==4||t==5&&parseInt(n)===2)&&e.isNull(a)&&(a="个人");if(parseInt(t)!==0&&!s.invoice.test(a)){r.popalert("您填写的发票抬头包含非法字符，请重新输入！");return}if(t==0){if(e.isNull(a)){r.popalert("请输入发票抬头！");return}if(!s.invoice.test(a)){r.popalert("您填写的发票抬头包含非法字符，请重新输入！");return}}t==5&&(a=a?e.trim(a):"",a||(a="个人"));var c=JSON.stringify({invoice_kind:t,invoice_type:n?n:"",invoice_title:a?a:"",invoice_name:f,invoice_shop:u.invoice_shop}),h=i.getParamStr(o);e.url.redirect(e.url.getTouchBaseUrl()+"order/index.html?"+h+"&invoice="+encodeURIComponent(JSON.stringify(c)))})})})}),define("controller/order/invoice",function(){});